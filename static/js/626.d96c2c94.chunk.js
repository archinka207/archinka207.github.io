"use strict";(self.webpackChunktwentythree=self.webpackChunktwentythree||[]).push([[626],{626:(e,a,s)=>{s.r(a),s.d(a,{default:()=>w});var t=s(5043),r=s(5094),n=s(342),l=s(5460),i=s(1719),o=s(5296),d=s(7417),c=s(8628),m=s(1072),u=s(8602),p=s(4282),h=s(680),x=s(579);const g=e=>{let{initialData:a,onSubmit:s,onCancel:r,loading:n,serverError:g}=e;const[f,j]=(0,t.useState)(a.nickname||""),[v,b]=(0,t.useState)(new Set(a.interestIds||[])),[y,A]=(0,t.useState)([]),[N,k]=(0,t.useState)(""),[w,C]=(0,t.useState)(!0);(0,t.useEffect)((()=>{j(a.nickname||""),b(new Set(a.interestIds||[]))}),[a]),(0,t.useEffect)((()=>{(async()=>{C(!0),k("");try{const e=await(0,h.D)();A(e||[])}catch(e){console.error("Failed to load interests for profile form:",e),k("Could not load available interests. Please try again later.")}finally{C(!1)}})()}),[]);return(0,x.jsxs)(l.A,{onSubmit:e=>{e.preventDefault(),k(""),f.trim()?f.trim().length<3||f.trim().length>50?k("Nickname must be between 3 and 50 characters."):s({nickname:f.trim(),interestIds:Array.from(v)}):k("Nickname cannot be empty.")},children:[N&&(0,x.jsx)(i.A,{variant:"warning",size:"sm",className:"mb-3 py-1",children:N}),g&&(0,x.jsx)(i.A,{variant:"danger",size:"sm",className:"mb-3 py-1",children:g}),(0,x.jsx)(o.A,{controlId:"profileEditNickname",label:"Nickname",className:"mb-4",children:(0,x.jsx)(l.A.Control,{type:"text",placeholder:"Enter your new nickname",value:f,onChange:e=>j(e.target.value),required:!0,disabled:n,minLength:3,maxLength:50})}),(0,x.jsxs)(l.A.Group,{className:"mb-4",children:[(0,x.jsx)(l.A.Label,{as:"h5",className:"mb-3",children:"Select Your Interests"}),w?(0,x.jsxs)("div",{className:"text-center my-3",children:[(0,x.jsx)(d.A,{animation:"border",size:"sm"}),(0,x.jsx)("span",{className:"ms-2",children:"Loading interests..."})]}):y.length>0?(0,x.jsxs)(c.A,{children:[" ",(0,x.jsxs)(c.A.Body,{style:{maxHeight:"300px",overflowY:"auto"},children:[" ",(0,x.jsxs)(m.A,{xs:1,md:2,className:"g-2",children:[" ",y.map((e=>(0,x.jsx)(u.A,{children:(0,x.jsx)(l.A.Check,{type:"checkbox",id:"interest-edit-".concat(e.id),label:e.name,checked:v.has(e.id),onChange:()=>(e=>{const a=new Set(v);a.has(e)?a.delete(e):a.add(e),b(a)})(e.id),disabled:n,className:"mb-2"})},e.id)))]})]})]}):(0,x.jsx)("p",{className:"text-muted",children:"No interests available to select at the moment."})]}),(0,x.jsxs)("div",{className:"d-flex justify-content-end mt-4 pt-3 border-top",children:[(0,x.jsx)(p.A,{variant:"outline-secondary",onClick:r,disabled:n,className:"me-2",children:"Cancel"}),(0,x.jsx)(p.A,{variant:"primary",type:"submit",disabled:n||w,children:n?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.A,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"}),(0,x.jsx)("span",{className:"ms-1",children:"Saving..."})]}):"Save Changes"})]})]})};var f=s(3387),j=s(3519),v=s(3637),b=s(4063),y=s(4648),A=s(353),N=s(5594),k=s(3260);const w=()=>{const{currentUser:e,updateUserContext:a,loading:s}=(0,n.A)(),[o,h]=(0,t.useState)(null),[w,C]=(0,t.useState)(!0),[S,E]=(0,t.useState)(""),[P,I]=(0,t.useState)(!1),[F,U]=(0,t.useState)(null),[z,L]=(0,t.useState)(!1),[D,G]=(0,t.useState)(""),B=(0,t.useCallback)((async()=>{if(e&&e.id){C(!0),E("");try{const e=await(0,f.VM)();h(e)}catch(r){var a,t;console.error("Failed to load profile:",r),E((null===(a=r.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"Failed to load profile data."),h(null)}finally{C(!1)}}else s||(E("User not authenticated or session expired."),C(!1),h(null))}),[e,s]);(0,t.useEffect)((()=>{s||B()}),[s,B]);return s?(0,x.jsx)(N.Y,{message:"Loading session..."}):w||!o&&!S?(0,x.jsx)(N.Y,{message:"Loading profile..."}):S||!o?(0,x.jsx)(j.A,{className:"mt-5 text-center",children:(0,x.jsxs)(i.A,{variant:"danger",children:[" ",(0,x.jsx)("h4",{children:"Error"}),(0,x.jsx)("p",{children:S||"Could not load profile data."}),(0,x.jsx)(k.N_,{to:"/",children:"Go to Homepage"})]})}):(0,x.jsx)(j.A,{children:(0,x.jsx)(m.A,{className:"justify-content-center",children:(0,x.jsx)(u.A,{md:10,lg:8,xl:7,children:(0,x.jsxs)(c.A,{className:"p-3 p-md-4 shadow-sm",children:[(0,x.jsx)(c.A.Title,{as:"h2",className:"text-center mb-4",children:P?"Edit Profile":"My Profile"}),D&&(0,x.jsx)(r.A,{variant:"danger",message:D,onClose:()=>G("")}),!P&&(0,x.jsxs)("div",{className:"text-center mb-4",children:[(0,x.jsx)(v.A,{src:(0,A.m_)(o.profilePictureUrl)||y,alt:o.nickname,roundedCircle:!0,className:"profile-avatar mb-3",onError:e=>{e.target.onerror=null,e.target.src=y}}),(0,x.jsx)("h4",{children:o.nickname}),(0,x.jsxs)("p",{className:"text-muted",children:["Reputation: ",o.reputation]}),(0,x.jsxs)("p",{className:"text-muted small",children:["Member since: ",new Date(o.createdAt).toLocaleDateString()]}),(0,x.jsxs)(l.A.Group,{controlId:"avatar-upload-input",className:"mt-3 mb-2",children:[(0,x.jsx)(l.A.Label,{visuallyHidden:!0,children:"Upload new avatar"}),(0,x.jsx)(l.A.Control,{type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const a=e.target.files[0];if(!a.type.startsWith("image/"))return G("Please select a valid image file (e.g., PNG, JPG, GIF)."),U(null),void(e.target.value=null);if(a.size>5242880)return G("Avatar file is too large. Maximum size is 5MB."),U(null),void(e.target.value=null);U(a),G("")}},size:"sm",disabled:z})]}),F&&(0,x.jsx)(p.A,{onClick:async()=>{if(F&&o){L(!0),G("");try{const e=await(0,f.OJ)(F);h(e),a({profilePictureUrl:e.profilePictureUrl}),U(null),document.getElementById("avatar-upload-input")&&(document.getElementById("avatar-upload-input").value=null),alert("Avatar updated successfully!")}catch(t){var e,s;console.error("Failed to upload avatar:",t),G((null===(e=t.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to upload avatar.")}finally{L(!1)}}},disabled:z,size:"sm",variant:"info",children:z?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(d.A,{as:"span",size:"sm",animation:"border",className:"me-1"})," Uploading..."]}):"Upload New Avatar"})]}),P?(0,x.jsx)(g,{initialData:{nickname:o.nickname,interestIds:o.interests.map((e=>e.id))},onSubmit:async e=>{if(o){C(!0),G("");try{const s=await(0,f.eg)(e);h(s),a(s),I(!1),alert("Profile updated successfully!")}catch(r){var s,t;console.error("Failed to update profile:",r),G((null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Failed to update profile.")}finally{C(!1)}}},onCancel:()=>{I(!1),G("")},loading:w,serverError:D}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("hr",{}),(0,x.jsx)("h5",{className:"mt-4 mb-3",children:"Interests:"}),o.interests&&o.interests.length>0?(0,x.jsx)(m.A,{xs:1,sm:2,md:3,className:"g-2",children:o.interests.map((e=>(0,x.jsx)(u.A,{children:(0,x.jsx)(b.A,{pill:!0,bg:"light",text:"dark",className:"p-2 w-100 text-truncate",children:e.name})},e.id)))}):(0,x.jsx)("p",{className:"text-muted",children:"You haven't selected any interests yet."}),(0,x.jsx)(p.A,{variant:"primary",onClick:()=>I(!0),className:"w-100 mt-4",children:"Edit Profile and Interests"})]})]})})})})}},680:(e,a,s)=>{s.d(a,{D:()=>r});var t=s(2162);const r=async()=>{try{return(await t.A.get("/interests")).data}catch(a){var e;return console.error("Error fetching interests:",(null===(e=a.response)||void 0===e?void 0:e.data)||a.message),[]}}},4063:(e,a,s)=>{s.d(a,{A:()=>u});var t=s(2555),r=s(45),n=s(8139),l=s.n(n),i=s(5043),o=s(7852),d=s(579);const c=["bsPrefix","bg","pill","text","className","as"],m=i.forwardRef(((e,a)=>{let{bsPrefix:s,bg:n="primary",pill:i=!1,text:m,className:u,as:p="span"}=e,h=(0,r.A)(e,c);const x=(0,o.oU)(s,"badge");return(0,d.jsx)(p,(0,t.A)((0,t.A)({ref:a},h),{},{className:l()(u,x,i&&"rounded-pill",m&&"text-".concat(m),n&&"bg-".concat(n))}))}));m.displayName="Badge";const u=m},5094:(e,a,s)=>{s.d(a,{A:()=>n});s(5043);var t=s(1719),r=s(579);const n=e=>{let{variant:a="danger",message:s,show:n=!0,onClose:l,className:i="mt-3"}=e;if(!n||!s)return null;let o=s;if("object"===typeof s&&null!==s)if(s.response&&s.response.data)o="string"===typeof s.response.data.message?s.response.data.message:"string"===typeof s.response.data?s.response.data:s.response.data.errors?Object.values(s.response.data.errors).join(". "):"An unexpected error occurred. Please check console.";else if(s.message)o=s.message;else try{o=JSON.stringify(s)}catch(d){o="An unreadable error object was received."}return(0,r.jsx)(t.A,{variant:a,onClose:l,dismissible:!!l,className:i,role:"alert",children:o})}}}]);
//# sourceMappingURL=626.d96c2c94.chunk.js.map